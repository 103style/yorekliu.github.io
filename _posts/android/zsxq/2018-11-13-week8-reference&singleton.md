---
title: "Week8-Java基础知识学习"
categories:
  - Android
tags:
  - 知识星球
  - Java
  - Reference
  - Singleton
toc: true
toc_label: "目录"
last_modified_at: 2018-11-13T16:38:50+08:00
---

## Question
话题：Java基础知识学习  
1、Java中有哪几种引用？它们的含义和区别是什么？  
2、请用Java实现一个线程安全且高效的单例模式。  

## Answer

### 1. Java中有哪几种引用？它们的含义和区别是什么？

> 《深入理解Java虚拟机(第二版)》3.2.3节 再谈引用


在JDK1.2之后，Java对引用的概念进行了扩充，将引用分为**强引用(Strong Reference)、软引用(Soft Reference)、弱引用(Weak Reference)、虚引用(Phantom Reference)**4种，这4种引用强度依次逐渐减弱。  

**强引用**就是指在程序代码之中普遍存在的，类似`Object obj = new Object()`这类的引用。**只要强引用还存在，垃圾收集器永远不会回收掉被引用的对象。**如果想中断强引用关联着的对象，可以将引用赋值为null。

**软引用**是用来描述一些还有用但并非必需的对象。**对于软引用关联着的对象，在系统将要发生内存溢出异常之前，将会把这些对象列进回收范围之中进行第二次回收。**如果这次回收还没有足够的内存，才会抛出内存溢出异常。

**弱引用**也是用来描述非必须对象的，但是它的强度比软引用更弱一些，被弱引用关联着的对象只能生存到下一次垃圾收集发生之前。**当垃圾收集器工作时，无论当前内存是否足够，都会回收掉只被弱引用关联的对象。**

**虚引用**也成为幽灵引用或幻影引用，它是最弱的一种引用关系。**一个对象是否有虚引用的存在，完全不会对其生存时间构成影响，也无法通过虚引用来取得一个对象实例。**为一个对象设置虚引用关联的唯一目的就是能在这个对象被收集器回收时收到一个系统通知。  
要注意的是，虚引用必须和引用队列关联使用，当垃圾回收器准备回收一个对象时，如果发现它还有虚引用，就会把这个虚引用加入到与之关联的引用队列中。程序可以通过判断引用队列中是否已经加入了虚引用，来了解被引用的对象是否将要被垃圾回收。如果程序发现某个虚引用已经被加入到引用队列，那么就可以在所引用的对象的内存被回收之前采取必要的行动。  

> 关于引用队列`ReferenceQueue`的例子，可以参考[Glide v4 源码解析（三）——深入探究Glide缓存机制](/android/glide3/#4-activeresources)一文中关于ActiveResources的相关描述。

### 2. 请用Java实现一个线程安全且高效的单例模式。  

Java中单例模式推荐**[DCL模式](/design%20patterns/singleton/#33-double-check-lockdcl模式)**和**[静态内部类模式](/design%20patterns/singleton/#34-静态内部类模式)**两种。  [More](/design%20patterns/singleton/)
