---
categories:
  - Android
  - Android杂记
tags:
  - CopyOnWriteArrayList
  - RemoteCallbackList
toc: true
toc_label: "目录"
toc_icon: "heart"
---

CopyOnWriteArrayList支持并发读写。

RemoteCallbackList支持跨进程删除listener，原理是`ArrayMap<IBinder, Callback>`。IPC时Parcelable对象会序列化、反序列化，因此不会是同一个对象，但底层IBinder不会变。
它同时具有以下特点：
1. 客户端进程终止后，能够自动移除客户端注册的listener
2. RemoteCallbackList内部自动实现了线程同步功能，所以使用它来进行注册、解注册时不需要做额外的线程同步工作。

EditText禁止进入时弹出键盘：
```xml
android:windowSoftInputMode="stateHidden|stateAlwaysHidden"
```
键盘弹出时禁止顶动View：
```xml
android:windowSoftInputMode="adjustPan"
```

跳转拨号盘
```java
new Intent(Intent.ACTION_DIAL, Uri.parse("tel:12306"));
```
直接拨打电话
```java
new Intent(Intent.ACTION_CALL, Uri.parse("tel:12306"));
```
发送短信
```java
new Intent(Intent.ACTION_SENDTO, Uri.parse("smsto:12306"));
```

Java Bean实体进行排序
```java
Collections.sort(mRowsBeanList, new Number2zComparator());

private class Number2zComparator implements Comparator<T> {
    @Override
    public int compare(T o1, T o2) {
        boolean o1IsHot = o1.getHotFlag() == 1;
        boolean o2IsHot = o2.getHotFlag() == 1;
        String o1Letter = PinyinUtils.ccs2Pinyin(o1.getPlatformName());
        String o2Letter = PinyinUtils.ccs2Pinyin(o2.getPlatformName());

        if (o1IsHot && o2IsHot) {
            return o1Letter.compareToIgnoreCase(o2Letter);
        } else if (o1IsHot) {
            return -1;
        } else if (o2IsHot) {
            return 1;
        }

        return o1Letter.compareToIgnoreCase(o2Letter);
    }
}
```
o1与o2进行比较，如果o1要排在o2前面，返回-1;如果两者相等，返回0;如果o1排在o2后面，返回1。

Gif加载
在尝试Glide加载(不卡，但是图片错乱了)、帧动画实现(超级耗内存，30帧，每帧8k原图，耗内存大约20M)、android-gif-drawable库(Android O异常卡顿，耗内存大约10M)加载失败之后，找到了一种新奇的思路：每隔一段时间调用`setBackgroundResource`，内存消耗基本不计。

代码设置drawable：
setCompoundDrawablesWithIntrinsicBounds
